<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchase Order - {{ po_number }}</title>
    <link rel="stylesheet" href="../css/purchase_order_base.css">
    <link rel="stylesheet" href="../css/po_domestic_distributor.css">
</head>
<body>
    <div class="page-container">
        {% if _is_first_page|default(true) %}
        <!-- Full Header Section - First Page Only -->
        <table class="po-header">
            <tr>
                <td class="header-logo">
                    {% if buyer_logo %}
                    <img src="{{ buyer_logo }}" alt="{{ buyer_company }}" class="company-logo">
                    {% endif %}
                </td>
                <td class="header-info">
                    <h1 class="po-title">PURCHASE ORDER</h1>
                    <div class="po-number">{{ po_number }}</div>
                    <div class="po-date">Date: {{ po_date }}</div>
                    <div class="po-status status-{{ status|lower }}">{{ status }}</div>
                </td>
            </tr>
        </table>

        <!-- Address Section (3 columns: Vendor, Ship To, Buyer) -->
        <table class="address-section">
            <tr>
                <td class="address-block">
                    <div class="address-label">VENDOR</div>
                    <div class="address-content">
                        <strong>{{ supplier_name }}</strong><br>
                        {{ supplier_address }}<br>
                        {{ supplier_city }}, {{ supplier_state }} {{ supplier_zip }}<br>
                        {% if supplier_phone %}Phone: {{ supplier_phone }}<br>{% endif %}
                        {% if supplier_email %}Email: {{ supplier_email }}{% endif %}
                    </div>
                </td>
                <td class="address-block">
                    <div class="address-label">SHIP TO</div>
                    <div class="address-content">
                        <strong>{{ ship_to_name }}</strong><br>
                        {{ ship_to_address }}<br>
                        {{ ship_to_city }}, {{ ship_to_state }} {{ ship_to_zip }}<br>
                        {% if ship_to_phone %}Phone: {{ ship_to_phone }}{% endif %}
                    </div>
                </td>
                <td class="address-block">
                    <div class="address-label">BUYER</div>
                    <div class="address-content">
                        <strong>{{ buyer_company }}</strong><br>
                        {{ buyer_address }}<br>
                        {{ buyer_city }}, {{ buyer_state }} {{ buyer_zip }}<br>
                        {% if buyer_phone %}Phone: {{ buyer_phone }}<br>{% endif %}
                        {% if buyer_email %}Email: {{ buyer_email }}{% endif %}
                    </div>
                </td>
            </tr>
        </table>

        <!-- Terms Section -->
        <table class="terms-section">
            <tr>
                <td class="term-cell">
                    <div class="term-label">Payment Terms</div>
                    <div class="term-value">{{ payment_terms }}</div>
                </td>
                <td class="term-cell">
                    <div class="term-label">Shipping Method</div>
                    <div class="term-value">{{ shipping_method }}</div>
                </td>
                <td class="term-cell">
                    <div class="term-label">Requested Delivery</div>
                    <div class="term-value">{{ requested_delivery_date }}</div>
                </td>
                <td class="term-cell">
                    <div class="term-label">FOB</div>
                    <div class="term-value">{{ fob|default('Destination', true) }}</div>
                </td>
            </tr>
        </table>
        {% else %}
        <!-- Compact Header - Continuation Pages -->
        <table class="continuation-header">
            <tr>
                <td class="left">
                    <strong>{{ buyer_company }}</strong> | 
                    <span style="color: #666;">PO #{{ po_number }}</span>
                </td>
                <td class="right">Page {{ _page_number }} of {{ _total_pages }}</td>
            </tr>
        </table>
        {% endif %}

        <!-- Line Items Table -->
        <table class="items-table">
            <thead>
                <tr>
                    <th class="col-line">Line</th>
                    <th class="col-sku">SKU / Part #</th>
                    <th class="col-description">Description</th>
                    <th class="col-qty">Qty</th>
                    <th class="col-uom">UOM</th>
                    <th class="col-unit-price">Unit Cost</th>
                    <th class="col-total">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items|default(line_items, true) %}
                <tr class="item-row {% if loop.index % 2 == 0 %}row-even{% else %}row-odd{% endif %}">
                    <td class="col-line">{{ item.line_number }}</td>
                    <td class="col-sku">{{ item.supplier_sku }}</td>
                    <td class="col-description">
                        <strong>{{ item.product_name }}</strong>
                        {% if item.brand %}
                        <div class="item-brand">Brand: {{ item.brand }}</div>
                        {% endif %}
                        {% if item.product_category %}
                        <div class="item-category">Category: {{ item.product_category }}</div>
                        {% endif %}
                    </td>
                    <td class="col-qty">{{ item.quantity_ordered|default(item.quantity) }}</td>
                    <td class="col-uom">{{ item.unit_of_measure|default('Each') }}</td>
                    <td class="col-unit-price">${{ "%.2f"|format(item.unit_cost|default(item.unit_price)|to_float) }}</td>
                    <td class="col-total">${{ "%.2f"|format((item.line_total|default(item.amount)|default((item.quantity_ordered|default(item.quantity)) * (item.unit_cost|default(item.unit_price)|to_float)))|to_float) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if _is_last_page|default(true) %}
        <!-- Totals Section - Last Page Only -->
        <table class="totals-section">
            <tr>
                <td class="totals-label">Subtotal:</td>
                <td class="totals-value">${{ "%.2f"|format(subtotal|to_float) }}</td>
            </tr>
            {% if shipping_cost and (shipping_cost|to_float) > 0 %}
            <tr>
                <td class="totals-label">Shipping & Handling:</td>
                <td class="totals-value">${{ "%.2f"|format(shipping_cost) }}</td>
            </tr>
            {% endif %}
            {% if tax and (tax|to_float) > 0 %}
            <tr>
                <td class="totals-label">Tax ({{ tax_rate }}):</td>
                <td class="totals-value">${{ "%.2f"|format(tax_amount|default(tax)|to_float) }}</td>
            </tr>
            {% endif %}
            <tr class="totals-final">
                <td class="totals-label">Total:</td>
                <td class="totals-value">${{ "%.2f"|format(total_amount|to_float) }}</td>
            </tr>
        </table>

        <!-- Special Instructions -->
        {% if special_instructions %}
        <div class="notes-section">
            <div class="notes-title">Special Instructions</div>
            <div class="notes-content">{{ special_instructions }}</div>
        </div>
        {% endif %}

        <!-- Signatures Section -->
        <table class="signatures-section">
            <tr>
                <td class="signature-block">
                    <div class="signature-label">Authorized By</div>
                    <div class="signature-line"></div>
                    <div class="signature-info">
                        <div class="signature-name">{{ buyer_contact_name }}</div>
                        <div class="signature-title">{{ buyer_contact_title|default('Purchasing Manager', true) }}</div>
                        <div class="signature-date">Date: _________________</div>
                    </div>
                </td>
                <td class="signature-block">
                    <div class="signature-label">Vendor Acceptance</div>
                    <div class="signature-line"></div>
                    <div class="signature-info">
                        <div class="signature-name">_______________________________</div>
                        <div class="signature-title">Authorized Representative</div>
                        <div class="signature-date">Date: _________________</div>
                    </div>
                </td>
            </tr>
        </table>

        <!-- Footer -->
        <div class="po-footer">
            <div class="footer-text">
                {{ buyer_company }} | {{ buyer_address }}, {{ buyer_city }}, {{ buyer_state }} {{ buyer_zip }}
                {% if buyer_phone %} | Phone: {{ buyer_phone }}{% endif %}
                {% if buyer_email %} | Email: {{ buyer_email }}{% endif %}
            </div>
            <div class="footer-page">{% if _page_number|default(none) %}Page {{ _page_number }} of {{ _total_pages }}{% endif %}</div>
        </div>
        {% else %}
        <!-- Continuation Notice -->
        <div style="text-align: right; color: #666; font-style: italic; margin-top: 20px;">
            Continued on page {{ (_page_number|default(1)) + 1 }}...
        </div>
        {% endif %}
    </div>
</body>
</html>

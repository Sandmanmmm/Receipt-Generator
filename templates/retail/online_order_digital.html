<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Purchase Receipt{% if _page_number|default(none) %} - Page {{ _page_number }} of {{ _total_pages }}{% endif %}</title>
    <link rel="stylesheet" href="../css/online_order_digital.css">
</head>
<body>
    <div class="digital-invoice">
        {% if _is_first_page|default(true) %}
        <!-- Header -->
        <div class="invoice-header">
            <div class="company-branding">
                <div class="logo-digital">
                    <span class="logo-icon">üíª</span>
                </div>
                <div class="company-details">
                    <h1 class="company-name">{{ supplier_name }}</h1>
                    <p class="company-tagline">{{ tagline }}</p>
                </div>
            </div>
            <div class="invoice-info">
                <div class="invoice-badge">DIGITAL PURCHASE</div>
                <div class="order-number">Order #{{ order_number }}</div>
                <div class="purchase-date">{{ purchase_date }}</div>
            </div>
        </div>

        <!-- Instant Access Banner -->
        <div class="access-banner">
            <div class="banner-icon">‚ö°</div>
            <div class="banner-content">
                <div class="banner-title">Instant Access Available</div>
                <div class="banner-text">Your digital products are ready to download and activate</div>
            </div>
        </div>

        <!-- Customer Information -->
        <div class="customer-section">
            <div class="customer-card">
                <h3 class="card-title">Account Information</h3>
                <p class="customer-name">{{ buyer_name }}</p>
                <p class="customer-email">{{ buyer_email }}</p>
                {% if account_id %}
                <div class="account-id">
                    <span class="account-label">Account ID:</span>
                    <span class="account-value">{{ account_id }}</span>
                </div>
                {% endif %}
            </div>
        </div>
        {% else %}
        <!-- Continuation Header -->
        <div class="continuation-header" style="padding: 20px; background: #e8eaf6; border-bottom: 3px solid #3f51b5; margin-bottom: 30px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div style="font-size: 24px; font-weight: bold; color: #303f9f;">{{ supplier_name }}</div>
                    <div style="color: #666; margin-top: 5px;">Order {{ order_number }} (Continued)</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 16px; color: #666;">Page {{ _page_number }} of {{ _total_pages }}</div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Digital Products -->
        <div class="products-section">
            <h2 class="section-heading">
                <span class="heading-icon"></span>
                Your Digital Products
            </h2>

            {# Pagination handled by template config - iterate over pre-sliced items #}
            {% for item in (digital_items|default(line_items)) %}
            <div class="digital-product-card">
                <div class="product-header">
                    <div class="product-icon-box">
                        {% if item.product_type == 'software' %}
                        <span class="product-icon">üíø</span>
                        {% elif item.product_type == 'game' %}
                        <span class="product-icon">üéÆ</span>
                        {% elif item.product_type == 'ebook' %}
                        <span class="product-icon">üìñ</span>
                        {% elif item.product_type == 'music' %}
                        <span class="product-icon">üéµ</span>
                        {% elif item.product_type == 'video' %}
                        <span class="product-icon">üé¨</span>
                        {% elif item.product_type == 'course' %}
                        <span class="product-icon">üéì</span>
                        {% else %}
                        <span class="product-icon">üìÑ</span>
                        {% endif %}
                    </div>
                    <div class="product-main-info">
                        <h3 class="product-name">{{ item.description }}</h3>
                        {% if item.version %}
                        <div class="product-version">Version {{ item.version }}</div>
                        {% endif %}
                        {% if item.platform %}
                        <div class="product-platform">
                            <span class="platform-label">Platform:</span>
                            <span class="platform-value">{{ item.platform }}</span>
                        </div>
                        {% endif %}
                    </div>
                    <div class="product-price">{{ item.total }}</div>
                </div>

                <div class="product-details">
                    <!-- License Key -->
                    {% if item.license_key %}
                    <div class="license-section">
                        <div class="license-header">
                            <span class="license-icon">üîë</span>
                            <span class="license-title">License Key</span>
                        </div>
                        <div class="license-key-box">
                            <code class="license-key">{{ item.license_key }}</code>
                            <button class="copy-button">Copy</button>
                        </div>
                        {% if item.license_type %}
                        <div class="license-type">{{ item.license_type }}</div>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- Activation Code -->
                    {% if item.activation_code %}
                    <div class="activation-section">
                        <div class="activation-header">
                            <span class="activation-icon">‚úÖ</span>
                            <span class="activation-title">Activation Code</span>
                        </div>
                        <div class="activation-code-box">
                            <code class="activation-code">{{ item.activation_code }}</code>
                            <button class="copy-button">Copy</button>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Download Information -->
                    {% if item.download_url %}
                    <div class="download-section">
                        <div class="download-header">
                            <span class="download-icon">‚¨áÔ∏è</span>
                            <span class="download-title">Download</span>
                        </div>
                        <div class="download-info">
                            {% if item.file_size %}
                            <div class="download-detail">
                                <span class="detail-label">File Size:</span>
                                <span class="detail-value">{{ item.file_size }}</span>
                            </div>
                            {% endif %}
                            {% if item.system_requirements %}
                            <div class="download-detail">
                                <span class="detail-label">Requirements:</span>
                                <span class="detail-value">{{ item.system_requirements }}</span>
                            </div>
                            {% endif %}
                            <a href="{{ item.download_url }}" class="download-button">
                                <span class="download-btn-icon">‚¨áÔ∏è</span>
                                <span class="download-btn-text">Download Now</span>
                            </a>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Access Information (Streaming/Cloud) -->
                    {% if item.access_url %}
                    <div class="access-section">
                        <div class="access-header">
                            <span class="access-icon"></span>
                            <span class="access-title">Online Access</span>
                        </div>
                        <a href="{{ item.access_url }}" class="access-button">
                            <span class="access-btn-text">Access Now</span>
                            <span class="access-btn-icon">‚Üí</span>
                        </a>
                    </div>
                    {% endif %}

                    <!-- Subscription Information -->
                    {% if item.subscription_period %}
                    <div class="subscription-info">
                        <div class="sub-detail">
                            <span class="sub-icon"></span>
                            <span class="sub-label">Subscription:</span>
                            <span class="sub-value">{{ item.subscription_period }}</span>
                        </div>
                        {% if item.renewal_date %}
                        <div class="sub-detail">
                            <span class="sub-icon">üîÑ</span>
                            <span class="sub-label">Renews:</span>
                            <span class="sub-value">{{ item.renewal_date }}</span>
                        </div>
                        {% endif %}
                        {% if item.auto_renew %}
                        <div class="auto-renew-badge">Auto-Renew Enabled</div>
                        {% endif %}
                    </div>
                    {% endif %}

                    <!-- License Terms -->
                    {% if item.license_seats %}
                    <div class="license-terms">
                        <div class="license-seats">
                            <span class="seats-icon">üë•</span>
                            <span class="seats-text">{{ item.license_seats }} user license</span>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Expiry Information -->
                    {% if item.expiry_date %}
                    <div class="expiry-notice">
                        <span class="expiry-icon"></span>
                        <span class="expiry-text">License expires: {{ item.expiry_date }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
                {% endfor %}
        </div>

        <!-- Digital Delivery Information -->
        {% if delivery_instructions %}
        <div class="delivery-section">
            <h3>Digital Delivery</h3>
            <p>{{ delivery_instructions }}</p>
        </div>
        {% endif %}

        {% if _is_last_page|default(true) %}
        <!-- Order Summary -->
        <div class="totals-section">
            <div class="totals-container">
                <h3 class="totals-title">Order Summary</h3>
                <div class="totals-table">
                    <div class="total-row">
                        <span class="total-label">Subtotal ({{ total_items }} items):</span>
                        <span class="total-value">{{ subtotal }}</span>
                    </div>
                    {% if coupon_code %}
                    <div class="total-row discount-row">
                        <span class="total-label">üéüÔ∏è Promo Code ({{ coupon_code }}):</span>
                        <span class="total-value discount-value">-{{ coupon_discount }}</span>
                    </div>
                    {% endif %}
                    {% if tax_amount and tax_amount|float > 0 %}
                    <div class="total-row">
                        <span class="total-label">Tax:</span>
                        <span class="total-value">{{ tax_amount }}</span>
                    </div>
                    {% endif %}
                    <div class="total-row final-total">
                        <span class="total-label">Total:</span>
                        <span class="total-value">{{ total_amount }}</span>
                    </div>
                </div>
                
                <div class="no-shipping-notice">
                    <span class="notice-icon">‚úì</span>
                    <span class="notice-text">No shipping charges for digital products</span>
                </div>
            </div>
        </div>

        <!-- Payment Information -->
        <div class="payment-section">
            <h3 class="section-heading">
                <span class="heading-icon"></span>
                Payment Method
            </h3>
            <div class="payment-card">
                <div class="payment-details">
                    <span class="payment-icon"></span>
                    <span class="payment-method">{{ payment_method }}</span>
                    <span class="card-info">{{ card_type }} ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ {{ card_last_four }}</span>
                </div>
                <div class="payment-status">
                    <span class="status-badge paid">PAID</span>
                </div>
            </div>
            {% if transaction_id %}
            <div class="transaction-details">
                <span class="trans-label">Transaction ID:</span>
                <span class="trans-id">{{ transaction_id }}</span>
            </div>
            {% endif %}
        </div>

        <!-- Account Management -->
        <div class="account-section">
            <h3 class="account-title">Manage Your Purchases</h3>
            <div class="account-actions">
                <div class="action-card">
                    <div class="action-icon">üìö</div>
                    <div class="action-content">
                        <div class="action-name">My Library</div>
                        <div class="action-desc">View all your digital products</div>
                    </div>
                </div>
                <div class="action-card">
                    <div class="action-icon">üîë</div>
                    <div class="action-content">
                        <div class="action-name">License Manager</div>
                        <div class="action-desc">View and manage licenses</div>
                    </div>
                </div>
                <div class="action-card">
                    <div class="action-icon">‚¨áÔ∏è</div>
                    <div class="action-content">
                        <div class="action-name">Downloads</div>
                        <div class="action-desc">Re-download purchases anytime</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Support Section -->
        <div class="support-section">
            <div class="support-grid">
                <div class="support-card">
                    <h4 class="support-heading">Need Help?</h4>
                    <div class="support-content">
                        <p><strong>Technical Support:</strong></p>
                        <p>Email: {{ support_email }}</p>
                        <p>Phone: {{ support_phone }}</p>
                        <p>Available 24/7</p>
                    </div>
                </div>
                <div class="support-card">
                    <h4 class="support-heading">Installation Guide</h4>
                    <div class="support-content">
                        <p>Visit our knowledge base for:</p>
                        <ul>
                            <li>Step-by-step installation guides</li>
                            <li>Troubleshooting tips</li>
                            <li>Video tutorials</li>
                            <li>FAQ</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Refund Policy -->
        <div class="policy-section">
            <h3 class="policy-title">Digital Products Refund Policy</h3>
            <div class="policy-content">
                <p>Digital products may be eligible for refund within {{ refund_window }} days of purchase if:</p>
                <ul class="policy-list">
                    <li>The product has not been downloaded or activated</li>
                    <li>You've encountered technical issues we couldn't resolve</li>
                    <li>The product was purchased by mistake</li>
                </ul>
                <p class="policy-note">Note: Once a license key is revealed or product is downloaded, the purchase is considered final unless technical issues prevent use.</p>
            </div>
        </div>

        <!-- Footer -->
        <div class="invoice-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>{{ supplier_name }}</h4>
                    <p>{{ supplier_address }}</p>
                    <p>{{ supplier_city }}, {{ supplier_state }} {{ supplier_zip }}</p>
                </div>
                <div class="footer-section">
                    <h4>Customer Support</h4>
                    <p>Email: {{ support_email }}</p>
                    <p>Phone: {{ support_phone }}</p>
                    <p>24/7 Support Available</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <p>My Account | Order History</p>
                    <p>Download Center | Support</p>
                    <p>Terms of Service | Privacy</p>
                </div>
            </div>
            <div class="footer-legal">
                <p>This is your digital purchase receipt. Please save this email for your records.</p>
                <p>License keys and activation codes are unique to your purchase and should not be shared.</p>
                <p>Thank you for your purchase from {{ supplier_name }}!</p>
            </div>
        </div>
        {% else %}
        <!-- Continuation Footer -->
        <div class="continuation-footer" style="margin-top: 30px; padding: 20px; background: #e8eaf6; border-top: 2px solid #ddd; text-align: center;">
            <div style="color: #666; font-size: 14px;">Continued on page {{ (_page_number|default(1)) + 1 }}...</div>
        </div>
        {% endif %}
    </div>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orderchamp Invoice</title>
    <link rel="stylesheet" href="../css/orderchamp_invoice.css">
</head>
<body>
    <div class="invoice-page">
        {% if _is_first_page|default(true) %}
        <!-- First Page Header -->
        <div class="header">
            <!-- Platform Logo -->
            <div class="logo-section">
                <div class="orderchamp-logo">
                    <span class="logo-icon">‚óÜ</span>
                    <span class="logo-text">{{ platform_name|default('orderchamp') }}</span>
                </div>
                <div class="invoice-badge">INVOICE</div>
            </div>

            <!-- Invoice Details Row -->
            <table class="details-row">
                <tr>
                    <td class="detail-block">
                        <div class="detail-label">Invoice Number</div>
                        <div class="detail-value">{{ invoice_number }}</div>
                    </td>
                    <td class="detail-block">
                        <div class="detail-label">Order Number</div>
                        <div class="detail-value">{{ order_number }}</div>
                    </td>
                    <td class="detail-block">
                        <div class="detail-label">Order Date</div>
                        <div class="detail-value">{{ order_date }}</div>
                    </td>
                    <td class="detail-block">
                        <div class="detail-label">Payment Terms</div>
                        <div class="detail-value">{{ payment_terms|default('Net 60') }}</div>
                    </td>
                </tr>
            </table>
        </div>

        <!-- Parties Section -->
        <table class="parties-section">
            <tr>
                <td class="party-column">
                    <div class="party-header">
                        <span class="party-icon">üè≠</span>
                        <span class="party-title">Brand / Supplier</span>
                    </div>
                    <div class="party-content">
                        <div class="party-name">{{ supplier_name }}</div>
                        <div class="party-line">{{ supplier_address }}</div>
                        {% if supplier_city %}
                        <div class="party-line">{{ supplier_postal|default('') }} {{ supplier_city }}</div>
                        {% endif %}
                        {% if supplier_country %}
                        <div class="party-line">{{ supplier_country }}</div>
                        {% endif %}
                        {% if supplier_vat %}
                        <div class="party-vat">VAT: {{ supplier_vat }}</div>
                        {% endif %}
                        {% if supplier_kvk %}
                        <div class="party-kvk">KvK: {{ supplier_kvk }}</div>
                        {% endif %}
                    </div>
                </td>
                <td class="party-column">
                    <div class="party-header">
                        <span class="party-icon">üè™</span>
                        <span class="party-title">Retailer / Bill To</span>
                    </div>
                    <div class="party-content">
                        <div class="party-name">{{ buyer_name }}</div>
                        <div class="party-line">{{ buyer_company|default('') }}</div>
                        <div class="party-line">{{ buyer_address }}</div>
                        {% if buyer_city %}
                        <div class="party-line">{{ buyer_postal|default('') }} {{ buyer_city }}</div>
                        {% endif %}
                        {% if buyer_country %}
                        <div class="party-line">{{ buyer_country }}</div>
                        {% endif %}
                        {% if buyer_vat %}
                        <div class="party-vat">VAT: {{ buyer_vat }}</div>
                        {% endif %}
                    </div>
                </td>
                <td class="party-column">
                    <div class="party-header">
                        <span class="party-icon">üì¶</span>
                        <span class="party-title">Ship To</span>
                    </div>
                    <div class="party-content">
                        <div class="party-name">{{ shipping_name|default(buyer_name) }}</div>
                        {% if shipping_company|default(buyer_company) %}
                        <div class="party-line">{{ shipping_company|default(buyer_company) }}</div>
                        {% endif %}
                        <div class="party-line">{{ shipping_address|default(buyer_address) }}</div>
                        {% if shipping_city|default(buyer_city) %}
                        <div class="party-line">{{ shipping_postal|default(buyer_postal)|default('') }} {{ shipping_city|default(buyer_city) }}</div>
                        {% endif %}
                        {% if shipping_country|default(buyer_country) %}
                        <div class="party-line">{{ shipping_country|default(buyer_country) }}</div>
                        {% endif %}
                    </div>
                </td>
            </tr>
        </table>

        {% else %}
        <!-- Continuation Page Header -->
        <div class="continuation-header">
            <div class="cont-logo">
                <span class="logo-icon-small">‚óÜ</span>
                <span class="logo-text-small">{{ platform_name|default('orderchamp') }}</span>
            </div>
            <div class="cont-info">
                <span>Invoice {{ invoice_number }}</span>
                <span class="separator">|</span>
                <span>Order {{ order_number }}</span>
                <span class="separator">|</span>
                <span>Page {{ _current_page }} of {{ _total_pages }}</span>
            </div>
        </div>
        {% endif %}

        <!-- Items Table -->
        <table class="items-table">
            <thead>
                <tr>
                    <th class="col-product">Product</th>
                    <th class="col-sku">SKU / EAN</th>
                    <th class="col-qty">Qty</th>
                    <th class="col-price">Unit Price</th>
                    <th class="col-vat">VAT %</th>
                    <th class="col-total">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr class="item-row">
                    <td class="col-product">
                        <div class="product-name">{{ item.description }}</div>
                        {% if item.variant %}
                        <div class="product-variant">{{ item.variant }}</div>
                        {% endif %}
                        {% if item.style %}
                        <div class="product-style">Style: {{ item.style }}</div>
                        {% endif %}
                        {% if item.category %}
                        <div class="product-category">{{ item.category }}</div>
                        {% endif %}
                        {% if item.color or item.size %}
                        <div class="product-attrs">
                            {% if item.color %}Color: {{ item.color }}{% endif %}
                            {% if item.color and item.size %} | {% endif %}
                            {% if item.size %}Size: {{ item.size }}{% endif %}
                        </div>
                        {% endif %}
                    </td>
                    <td class="col-sku">
                        {% if item.sku %}
                        <div class="sku-value">{{ item.sku }}</div>
                        {% endif %}
                        {% if item.ean or item.upc %}
                        <div class="ean-value">{{ item.ean|default(item.upc) }}</div>
                        {% endif %}
                    </td>
                    <td class="col-qty">{{ item.quantity }}</td>
                    <td class="col-price">{{ item.unit_price }}</td>
                    <td class="col-vat">{{ item.vat_rate|default('21%') }}</td>
                    <td class="col-total">{{ item.total }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if _is_last_page|default(true) %}
        <!-- Totals Section -->
        <div class="totals-section">
            <table class="totals-table">
                <tr>
                    <td class="totals-spacer"></td>
                    <td class="totals-content">
                        <table class="totals-inner">
                            <tr>
                                <td class="total-label">Subtotal (excl. VAT)</td>
                                <td class="total-value">{{ subtotal_excl_vat|default(subtotal) }}</td>
                            </tr>
                            {% if vat_21_amount %}
                            <tr>
                                <td class="total-label">VAT 21%</td>
                                <td class="total-value">{{ vat_21_amount }}</td>
                            </tr>
                            {% endif %}
                            {% if vat_9_amount %}
                            <tr>
                                <td class="total-label">VAT 9%</td>
                                <td class="total-value">{{ vat_9_amount }}</td>
                            </tr>
                            {% endif %}
                            {% if tax_amount and not vat_21_amount %}
                            <tr>
                                <td class="total-label">VAT</td>
                                <td class="total-value">{{ tax_amount }}</td>
                            </tr>
                            {% endif %}
                            <tr>
                                <td class="total-label">Shipping</td>
                                <td class="total-value">{% if (shipping_cost_raw or 0) == 0 %}Free{% else %}{{ shipping_cost }}{% endif %}</td>
                            </tr>
                            {% if discount_raw and discount_raw > 0 %}
                            <tr class="discount-row">
                                <td class="total-label">{{ discount_label|default('Discount') }}</td>
                                <td class="total-value discount-value">-{{ discount }}</td>
                            </tr>
                            {% endif %}
                            <tr class="grand-total-row">
                                <td class="total-label grand-label">Total (incl. VAT)</td>
                                <td class="total-value grand-value">{{ total }}</td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </div>

        <!-- Payment Info -->
        <div class="payment-section">
            <div class="payment-header">Payment Information</div>
            <table class="payment-details">
                <tr>
                    <td class="payment-block">
                        <div class="payment-label">Payment Method</div>
                        <div class="payment-value">{{ payment_method|default('Orderchamp Pay') }}</div>
                    </td>
                    <td class="payment-block">
                        <div class="payment-label">Payment Terms</div>
                        <div class="payment-value">{{ payment_terms|default('Net 60') }}</div>
                    </td>
                    <td class="payment-block">
                        <div class="payment-label">Due Date</div>
                        <div class="payment-value">{{ due_date|default('Upon Receipt') }}</div>
                    </td>
                    {% if reference_number %}
                    <td class="payment-block">
                        <div class="payment-label">Reference</div>
                        <div class="payment-value">{{ reference_number }}</div>
                    </td>
                    {% endif %}
                </tr>
            </table>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-note">
                This invoice was generated through {{ platform_company|default('Orderchamp B.V.') }} | {{ platform_address|default('Keizersgracht 520, 1017 EK Amsterdam, Netherlands') }}
            </div>
            <div class="footer-links">
                <span>KvK: {{ platform_kvk|default('70652546') }}</span>
                <span class="separator">|</span>
                <span>VAT: {{ platform_vat|default('NL858407785B01') }}</span>
                <span class="separator">|</span>
                <span>{{ platform_email|default('support@orderchamp.com') }}</span>
                <span class="separator">|</span>
                <span>{{ platform_phone|default('+31 (0)20 308 08 08') }}</span>
            </div>
            <div class="page-number">Page {{ _current_page|default(1) }} of {{ _total_pages|default(1) }}</div>
        </div>

        {% else %}
        <!-- Continuation Footer -->
        <div class="continuation-footer">
            <span>Continued on next page...</span>
            <span class="page-number">Page {{ _current_page }} of {{ _total_pages }}</span>
        </div>
        {% endif %}
    </div>
</body>
</html>

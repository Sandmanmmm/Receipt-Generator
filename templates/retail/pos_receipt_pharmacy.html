<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharmacy Receipt</title>
    <link rel="stylesheet" href="../css/pos_receipt_pharmacy.css">
</head>
<body>
    <div class="pharmacy-receipt">
        <!-- Pharmacy Receipt with Rx and OTC items -->
        
        <!-- Pharmacy Header -->
        <div class="pharmacy-header">
            <h1 class="pharmacy-name">{{ supplier_name }}</h1>
            <p class="pharmacy-tagline">Your Health. Your Pharmacy.</p>
            <p class="pharmacy-address">{{ supplier_address }}</p>
            <p class="pharmacy-phone">{{ supplier_phone }}</p>
            <p class="pharmacy-license">PHARMACY LIC# {{ pharmacy_license }}</p>
        </div>

        <div class="divider-rx"></div>

        <!-- Transaction Info -->
        <div class="transaction-info">
            <div class="info-row">
                <span class="label">RECEIPT #:</span>
                <span class="value">{{ invoice_number }}</span>
            </div>
            <div class="info-row">
                <span class="label">DATE:</span>
                <span class="value">{{ invoice_date }}</span>
            </div>
            <div class="info-row">
                <span class="label">TIME:</span>
                <span class="value">{{ transaction_time }}</span>
            </div>
            <div class="info-row">
                <span class="label">REGISTER:</span>
                <span class="value">{{ register_number }}</span>
            </div>
            <div class="info-row">
                <span class="label">PHARMACIST:</span>
                <span class="value">{{ pharmacist_name }}</span>
            </div>
        </div>

        <div class="divider-rx"></div>

        <!-- Prescription Items (if any) -->
        {% set rx_items = line_items | selectattr('is_prescription', 'true') | list %}
        {% if rx_items %}
        <div class="rx-section">
            <div class="rx-header">
                <h2 class="rx-title">℞ PRESCRIPTION ITEMS</h2>
            </div>
            
            {% for item in rx_items %}
            <div class="rx-item">
                <div class="rx-item-header">
                    <span class="rx-number">Rx# {{ item.rx_number }}</span>
                    <span class="rx-price">{{ item.total }}</span>
                </div>
                
                <div class="rx-details">
                    <p class="drug-name">{{ item.drug_name }}</p>
                    <p class="drug-strength">{{ item.strength }} {{ item.form }}</p>
                    <p class="drug-quantity">QTY: {{ item.quantity }} {{ item.unit }}</p>
                    <p class="prescriber">DR. {{ item.prescriber }}</p>
                </div>
                
                {% if item.insurance_covered %}
                <div class="insurance-info">
                    <div class="insurance-row">
                        <span class="ins-label">Insurance Paid:</span>
                        <span class="ins-value">{{ item.insurance_paid }}</span>
                    </div>
                    <div class="insurance-row">
                        <span class="ins-label">Your Copay:</span>
                        <span class="ins-value">{{ item.copay }}</span>
                    </div>
                    <div class="insurance-row savings">
                        <span class="ins-label">You Saved:</span>
                        <span class="ins-value">{{ item.insurance_savings }}</span>
                    </div>
                </div>
                {% endif %}
                
                {% if item.refills_remaining %}
                <div class="refill-info">
                    <p class="refill-text">{{ item.refills_remaining }} REFILL(S) REMAINING</p>
                    <p class="refill-date">REFILL AFTER: {{ item.refill_after_date }}</p>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <div class="divider-rx"></div>
        {% endif %}

        <!-- Over-The-Counter Items -->
        {% set otc_items = line_items | selectattr('is_prescription', 'false') | list %}
        {% if otc_items %}
        <div class="otc-section">
            <h3 class="section-title">RETAIL ITEMS</h3>
            
            {% for item in otc_items %}
            <div class="otc-item">
                <div class="item-line">
                    <span class="item-name">{{ item.description }}</span>
                    <span class="item-price">{{ item.total }}</span>
                </div>
                <div class="item-meta">
                    <span class="item-upc">{{ item.upc }}</span>
                    <span class="item-qty">QTY: {{ item.quantity }}</span>
                    {% if item.unit_price %}
                    <span class="item-unit-price">@ {{ item.unit_price }}</span>
                    {% endif %}
                </div>
                
                {% if item.promotion %}
                <div class="item-promo">
                    <span class="promo-badge">SALE</span>
                    <span class="promo-text">{{ item.promotion }}</span>
                    <span class="promo-savings">-{{ item.discount }}</span>
                </div>
                {% endif %}
                
                {% if item.rewards_earned %}
                <div class="item-rewards">
                    <span class="rewards-icon">★</span>
                    <span class="rewards-text">{{ item.rewards_earned }} PTS</span>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <div class="divider"></div>
        {% endif %}

        <!-- Totals -->
        <div class="totals-section">
            <div class="total-row">
                <span class="total-label">SUBTOTAL:</span>
                <span class="total-value">{{ subtotal }}</span>
            </div>
            
            {% if total_insurance_paid > 0 %}
            <div class="total-row insurance">
                <span class="total-label">INSURANCE PAID:</span>
                <span class="total-value">{{ total_insurance_paid }}</span>
            </div>
            {% endif %}
            
            {% if total_discount > 0 %}
            <div class="total-row savings">
                <span class="total-label">SALE SAVINGS:</span>
                <span class="total-value">-{{ total_discount }}</span>
            </div>
            {% endif %}
            
            <div class="total-row">
                <span class="total-label">TAX:</span>
                <span class="total-value">{{ tax_amount }}</span>
            </div>
            
            <div class="total-row grand">
                <span class="total-label">AMOUNT DUE:</span>
                <span class="total-value">{{ total_amount }}</span>
            </div>
        </div>

        <div class="divider-rx"></div>

        <!-- Payment Info -->
        <div class="payment-section">
            <div class="payment-row">
                <span class="payment-label">PAYMENT METHOD:</span>
                <span class="payment-value">{{ payment_method }}</span>
            </div>
            {% if payment_method != "Cash" %}
            <div class="payment-row">
                <span class="payment-label">CARD:</span>
                <span class="payment-value">{{ card_type }} ****{{ card_last_four }}</span>
            </div>
            {% if approval_code %}
            <div class="payment-row">
                <span class="payment-label">APPROVAL:</span>
                <span class="payment-value">{{ approval_code }}</span>
            </div>
            {% endif %}
            {% else %}
            <div class="payment-row">
                <span class="payment-label">CASH TENDERED:</span>
                <span class="payment-value">{{ cash_tendered }}</span>
            </div>
            <div class="payment-row">
                <span class="payment-label">CHANGE:</span>
                <span class="payment-value">{{ change_amount }}</span>
            </div>
            {% endif %}
        </div>

        <!-- Rewards Program -->
        {% if loyalty_points_earned or loyalty_points_balance %}
        <div class="divider"></div>
        
        <div class="rewards-section">
            <h3 class="rewards-title">REWARDS PROGRAM</h3>
            {% if customer_id %}
            <div class="rewards-row">
                <span class="rewards-label">MEMBER #:</span>
                <span class="rewards-value">{{ customer_id }}</span>
            </div>
            {% endif %}
            {% if loyalty_points_earned %}
            <div class="rewards-row">
                <span class="rewards-label">POINTS EARNED:</span>
                <span class="rewards-value earned">{{ loyalty_points_earned }}</span>
            </div>
            {% endif %}
            {% if loyalty_points_balance %}
            <div class="rewards-row">
                <span class="rewards-label">POINTS BALANCE:</span>
                <span class="rewards-value">{{ loyalty_points_balance }}</span>
            </div>
            {% endif %}
            {% if loyalty_rewards_available %}
            <div class="rewards-available">
                {{ loyalty_rewards_available }} REWARD(S) AVAILABLE!
            </div>
            {% endif %}
        </div>
        {% endif %}

        <div class="divider-rx"></div>

        <!-- Important Pharmacy Information -->
        <div class="pharmacy-notices">
            <div class="notice-box">
                <p class="notice-title">IMPORTANT MEDICATION INFORMATION</p>
                <p class="notice-text">Please read all medication guides and follow prescriber instructions.</p>
                <p class="notice-text">Questions? Ask your pharmacist!</p>
            </div>
            
            {% if rx_items %}
            <div class="notice-box consultation">
                <p class="notice-title">PHARMACIST CONSULTATION OFFERED</p>
                <p class="notice-text">Federal law requires we offer counseling on new prescriptions.</p>
            </div>
            {% endif %}
        </div>

        <div class="divider"></div>

        <!-- Footer -->
        <div class="footer-section">
            <p class="footer-line">Return policy: {{ return_policy }}</p>
            {% if survey_url %}
            <p class="footer-line survey-header">SHARE YOUR EXPERIENCE</p>
            <p class="footer-line">{{ survey_url }}</p>
            <p class="footer-line">CODE: {{ survey_code }}</p>
            {% endif %}
        </div>

        <!-- Barcode -->
        {% if barcode_value %}
        <div class="barcode-section">
            <div class="barcode">|||| |||| |||| |||| ||||</div>
            <p class="barcode-number">{{ barcode_value }}</p>
        </div>
        {% endif %}

        <div class="thank-you">
            <p>THANK YOU FOR TRUSTING US</p>
            <p>WITH YOUR HEALTH!</p>
        </div>
    </div>
</body>
</html>

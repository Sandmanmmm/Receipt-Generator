<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Wholesale Purchase Order - {{ po_number }}</title>
    <link rel="stylesheet" href="../css/purchase_order_base.css">
    <link rel="stylesheet" href="../css/po_fashion_wholesale.css">
</head>
<body>
    <div class="po-page">
        {% if _is_first_page %}
        <!-- Full Header - First Page Only -->
        <header class="po-header">
            <div class="header-top">
                <table class="header-table">
                    <tr>
                        <td class="header-left">
                            {% if supplier_logo %}
                            <img src="{{ supplier_logo }}" alt="{{ supplier_name }}" class="supplier-logo" />
                            {% else %}
                            <div class="logo-placeholder">
                                <span class="logo-text">{{ supplier_name[:2]|upper }}</span>
                            </div>
                            {% endif %}
                            <div class="supplier-info">
                                <div class="supplier-name">{{ supplier_name }}</div>
                                <div class="supplier-tagline">Fashion Wholesale</div>
                            </div>
                        </td>
                        <td class="header-right">
                            <h1 class="doc-title">PURCHASE ORDER</h1>
                            <div class="po-number">{{ po_number }}</div>
                            <div class="season-badge">{{ season or 'SS 2025' }}</div>
                        </td>
                    </tr>
                </table>
            </div>
            
            <div class="header-details">
                <table class="details-table">
                    <tr>
                        <td class="detail-cell">
                            <div class="detail-label">PO Date</div>
                            <div class="detail-value">{{ po_date }}</div>
                        </td>
                        <td class="detail-cell">
                            <div class="detail-label">Delivery Date</div>
                            <div class="detail-value">{{ requested_delivery_date or delivery_date }}</div>
                        </td>
                        <td class="detail-cell">
                            <div class="detail-label">Ship Window</div>
                            <div class="detail-value">{{ ship_window or 'TBD' }}</div>
                        </td>
                        <td class="detail-cell">
                            <div class="detail-label">Payment Terms</div>
                            <div class="detail-value">{{ payment_terms }}</div>
                        </td>
                    </tr>
                </table>
            </div>
        </header>

        <!-- Address Cards -->
        <div class="address-section">
            <table class="address-table">
                <tr>
                    <td class="address-card">
                        <div class="card-title">Buyer</div>
                        <div class="card-line">{{ buyer_company }}</div>
                        {% if buyer_address %}
                        <div class="card-line">{{ buyer_address }}</div>
                        {% endif %}
                        {% if buyer_contact %}
                        <div class="card-line">Contact: {{ buyer_contact }}</div>
                        {% endif %}
                        {% if buyer_email %}
                        <div class="card-line">{{ buyer_email }}</div>
                        {% endif %}
                        {% if buyer_phone %}
                        <div class="card-line">{{ buyer_phone }}</div>
                        {% endif %}
                    </td>
                    <td class="address-card">
                        <div class="card-title">Supplier</div>
                        <div class="card-line">{{ supplier_name }}</div>
                        {% if supplier_address %}
                        <div class="card-line">{{ supplier_address }}</div>
                        {% endif %}
                        {% if supplier_contact %}
                        <div class="card-line">Contact: {{ supplier_contact }}</div>
                        {% endif %}
                        {% if supplier_email %}
                        <div class="card-line">{{ supplier_email }}</div>
                        {% endif %}
                        {% if supplier_phone %}
                        <div class="card-line">{{ supplier_phone }}</div>
                        {% endif %}
                    </td>
                    <td class="address-card">
                        <div class="card-title">Ship To</div>
                        <div class="card-line">{{ ship_to_name or buyer_company }}</div>
                        {% if ship_to_address or buyer_address %}
                        <div class="card-line">{{ ship_to_address or buyer_address }}</div>
                        {% endif %}
                        {% if ship_to_attention %}
                        <div class="card-line">Attn: {{ ship_to_attention }}</div>
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>

        {% else %}
        <!-- Continuation Header - Pages 2+ -->
        <div class="continuation-header">
            <table class="cont-header-table">
                <tr>
                    <td class="cont-left">
                        {% if supplier_logo %}
                        <img src="{{ supplier_logo }}" alt="{{ supplier_name }}" class="logo-cont" />
                        {% endif %}
                        <span class="cont-po">{{ po_number }}</span>
                        <span class="cont-season">{{ season or 'SS 2025' }}</span>
                    </td>
                    <td class="cont-right">
                        <span class="cont-page">Page {{ _current_page }} of {{ _total_pages }}</span>
                    </td>
                </tr>
            </table>
        </div>
        {% endif %}

        <!-- Line Items Table -->
        <div class="items-section">
            <table class="items-table">
                <thead>
                    <tr>
                        <th class="col-line">#</th>
                        <th class="col-style">Style Code</th>
                        <th class="col-description">Description</th>
                        <th class="col-color">Color</th>
                        <th class="col-size-run">Size Run</th>
                        <th class="col-qty">Total Qty</th>
                        <th class="col-unit-price">Wholesale Price</th>
                        <th class="col-msrp">MSRP</th>
                        <th class="col-total">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items|default(line_items, true) %}
                    <tr class="item-row">
                        <td class="col-line">{{ loop.index }}</td>
                        <td class="col-style">
                            <div class="style-code">{{ item.style_code|default(item.supplier_sku, true)|default(item.sku, true)|default('â€”', true) }}</div>
                            {% if item.collection|default(none) %}
                            <div class="collection-tag">{{ item.collection }}</div>
                            {% endif %}
                        </td>
                        <td class="col-description">
                            <div class="item-name">{{ item.product_name|default(item.description, true)|default(item.name, true) }}</div>
                            {% if item.material|default(none) %}
                            <div class="item-detail">Material: {{ item.material }}</div>
                            {% endif %}
                            {% if item.brand|default(none) %}
                            <div class="item-detail">Brand: {{ item.brand }}</div>
                            {% endif %}
                        </td>
                        <td class="col-color">
                            {% if item.color_name|default(none) %}
                            <div class="color-name">{{ item.color_name }}</div>
                            {% if item.color_code|default(none) %}
                            <div class="color-code">{{ item.color_code }}</div>
                            {% endif %}
                            {% else %}
                            <div class="color-name">Assorted</div>
                            {% endif %}
                        </td>
                        <td class="col-size-run">
                            {% if item.size_run|default(none) %}
                            <div class="size-breakdown">
                                {% for size, qty in item.size_run.items() %}
                                <span class="size-item">{{ size }}: {{ qty }}</span>
                                {% endfor %}
                            </div>
                            {% elif item.size|default(none) %}
                            <div class="single-size">{{ item.size }}</div>
                            {% else %}
                            <div class="single-size">OS</div>
                            {% endif %}
                        </td>
                        <td class="col-qty">{{ "{:,}".format((item.quantity_ordered|default(item.quantity, true)|default(1))|int) }}</td>
                        <td class="col-unit-price">${{ "%.2f"|format(item.unit_cost|default(item.unit_price, true)|to_float) }}</td>
                        <td class="col-msrp">
                            {% if item.msrp|default(none) %}
                            ${{ "%.2f"|format(item.msrp|to_float) }}
                            {% else %}
                            -
                            {% endif %}
                        </td>
                        <td class="col-total">${{ "{:,.2f}".format((item.line_total|default(item.total, true)|default(item.amount, true)|default(0))|to_float) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if _is_last_page %}
        <!-- Totals Section - Last Page Only -->
        <div class="totals-section">
            <table class="totals-table">
                <tr>
                    <td class="totals-label">Subtotal ({{ item_count|default((items|default(line_items, true))|length) }} styles)</td>
                    <td class="totals-value">${{ "{:,.2f}".format(subtotal|default(sub_total, true)|default(0)) }}</td>
                </tr>
                {% if ((volume_discount|default(0))|float) > 0 %}
                <tr>
                    <td class="totals-label">Volume Discount ({{ volume_discount_percentage|default(0) }}%)</td>
                    <td class="totals-value discount">-${{ "{:,.2f}".format(volume_discount) }}</td>
                </tr>
                {% endif %}
                {% if ((shipping_cost|default(shipping, true)|default(0))|float) > 0 %}
                <tr>
                    <td class="totals-label">Shipping & Handling</td>
                    <td class="totals-value">${{ "{:,.2f}".format(shipping_cost|default(shipping, true)) }}</td>
                </tr>
                {% endif %}
                {% if ((tax_amount|default(tax, true)|default(0))|float) > 0 %}
                <tr>
                    <td class="totals-label">Tax ({{ "%.1f"|format((tax_rate|default(tax_rate_percent, true)|default(0)) * 100) }}%)</td>
                    <td class="totals-value">${{ "{:,.2f}".format(tax_amount|default(tax, true)|to_float) }}</td>
                </tr>
                {% endif %}
                <tr class="total-row">
                    <td class="totals-label">TOTAL ORDER VALUE</td>
                    <td class="totals-value total-amount">${{ "{:,.2f}".format(total_amount|default(total, true)|default(grand_total, true)|default(0)) }}</td>
                </tr>
            </table>
        </div>

        <!-- Order Summary -->
        <div class="summary-section">
            <div class="section-title">Order Summary</div>
            <table class="summary-table">
                <tr>
                    <td class="summary-label">Total Units:</td>
                    <td class="summary-value">{{ total_units|default((items|default(line_items, true))|sum(attribute='quantity')|int, true) }} pcs</td>
                    <td class="summary-label">Total Styles:</td>
                    <td class="summary-value">{{ item_count|default((items|default(line_items, true))|length) }}</td>
                </tr>
                <tr>
                    <td class="summary-label">Avg Price/Unit:</td>
                    <td class="summary-value">${{ "%.2f"|format(avg_unit_price|default((subtotal|default(0)) / ((items|default(line_items, true))|sum(attribute='quantity')|int or 1), true)) }}</td>
                    <td class="summary-label">Delivery Window:</td>
                    <td class="summary-value">{{ ship_window|default('TBD') }}</td>
                </tr>
            </table>
        </div>

        <!-- Fashion-Specific Terms -->
        <div class="terms-section">
            <div class="section-title">Order Terms & Conditions</div>
            <div class="terms-grid">
                <div class="term-block">
                    <div class="term-label">Payment Terms:</div>
                    <div class="term-value">{{ payment_terms }}. {{ deposit_terms or 'No deposit required for established accounts.' }}</div>
                </div>
                <div class="term-block">
                    <div class="term-label">Returns & Exchanges:</div>
                    <div class="term-value">{{ return_policy or 'Defective merchandise only within 14 days of receipt. No returns on clearance items.' }}</div>
                </div>
                <div class="term-block">
                    <div class="term-label">Chargebacks:</div>
                    <div class="term-value">{{ chargeback_policy or 'Late delivery: 5% per week. Short shipment: makeup shipment or credit. Compliance violations subject to buyer chargeback terms.' }}</div>
                </div>
                <div class="term-block">
                    <div class="term-label">Labeling & Compliance:</div>
                    <div class="term-value">{{ labeling_requirements or 'All garments must include care labels, fiber content, country of origin per FTC regulations. Hangtags as specified.' }}</div>
                </div>
                <div class="term-block">
                    <div class="term-label">Packaging:</div>
                    <div class="term-value">{{ packaging_requirements or 'Individual polybags, sorted by style/color/size. Carton labels must include PO#, style code, size breakdown.' }}</div>
                </div>
                <div class="term-block">
                    <div class="term-label">Quality Standards:</div>
                    <div class="term-value">{{ quality_standards or 'AQL 2.5 inspection required. Pre-shipment samples available upon request. Buyer reserves right to third-party inspection.' }}</div>
                </div>
            </div>
        </div>

        <!-- Special Instructions -->
        {% if special_instructions|default(none) or packing_instructions|default(none) %}
        <div class="instructions-section">
            <div class="section-title">Special Instructions</div>
            {% if special_instructions|default(none) %}
            <div class="instruction-block">
                <strong>General:</strong> {{ special_instructions }}
            </div>
            {% endif %}
            {% if packing_instructions|default(none) %}
            <div class="instruction-block">
                <strong>Packing:</strong> {{ packing_instructions }}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Footer -->
        <footer class="po-footer">
            <div class="footer-content">
                <div class="approval-section">
                    <table class="approval-table">
                        <tr>
                            <td class="approval-col">
                                <div class="approval-label">Buyer Authorization:</div>
                                <div class="signature-line"></div>
                                <div class="signature-info">
                                    <span>{{ buyer_contact or 'Authorized Buyer' }}</span>
                                    <span class="date-field">Date: ___________</span>
                                </div>
                            </td>
                            <td class="approval-col">
                                <div class="approval-label">Supplier Acceptance:</div>
                                <div class="signature-line"></div>
                                <div class="signature-info">
                                    <span>{{ supplier_contact or 'Authorized Representative' }}</span>
                                    <span class="date-field">Date: ___________</span>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="footer-note">
                    This Purchase Order is subject to the terms and conditions outlined above. Supplier acceptance constitutes agreement to all terms.
                </div>
            </div>
            <div class="page-number">Page {{ _current_page }} of {{ _total_pages }}</div>
        </footer>

        {% else %}
        <!-- Continuation Footer - Pages 1 to N-1 -->
        <div class="continuation-footer">
            <div class="cont-footer-text">Continued on next page...</div>
            <div class="cont-page-number">Page {{ _current_page }} of {{ _total_pages }}</div>
        </div>
        {% endif %}
    </div>
</body>
</html>
